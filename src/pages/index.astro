---
// src/pages/index.astro
import '../styles/estilo.css';
import Layout from '../layouts/Layout.astro';
---

<Layout title="Rebol IA - Tu Asistente de Bot치nica">
  <nav> 
    <div class="title"><h3>Rebol IA</h3></div>
    <div class="options">
      <div class="login" id="abrir-modal">Acceder</div>
      <div class="contacto">Contacto</div>
    </div>
  </nav>

  <!-- Modal de acceso -->
  <div id="modal-acceso" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" id="cerrar-modal">&times;</span>
      <h2>Acceso</h2>
      <form id="form-login" autocomplete="off">
        <label for="login-usuario">Usuario:</label>
        <input type="text" id="login-usuario" name="usuario" required autocomplete="off" />
        <label for="login-password">Contrase침a:</label>
        <input type="password" id="login-password" name="password" required autocomplete="off" />
        <button type="submit">Iniciar sesi칩n</button>
        <div id="login-msg" style="margin-top:10px;color:#c00;font-size:0.95em;"></div>
      </form>
    </div>
  </div>

  <section class="section1">
    <div class="section1_img">
      <img src="/bonsai.jpg" alt="bonsai" />
    </div>
    <div class="section_text">
      <h2>Rebol IA</h2>
      <p>Espacio dedicado a el cuidado y la creaci칩n de mini biomas en casa. Aqu칤 aprender치s sobre su crecimiento, cuidados esenciales y c칩mo replicar un ecosistema equilibrado en un espacio reducido.</p>
      <p>Adem치s, podr치s dar seguimiento a tu propio mini bioma subiendo fotos peri칩dicamente. Con la ayuda de la inteligencia artificial, recibir치s recomendaciones personalizadas sobre si necesita agua u otros cuidados espec칤ficos para mantenerlo saludable.</p>
      <p>Exploraremos factores clave como humedad, iluminaci칩n y sustrato, adem치s de gu칤as paso a paso para crear tu propio mini bioma en terrarios o jardines cerrados.</p>
      <p>Si te apasiona la naturaleza, este sitio es para ti. Descubre c칩mo mantener un ecosistema autosuficiente y disfrutar de su belleza en tu hogar. 춰Acomp치침ame en este viaje verde!</p>
      <h4>Esta es la red social de las plantas!!</h4>
    </div>
  </section>
  <!-- 
  <section class="section_2">
    <div class="title_write">
      <h2>Vamos preg칰ntame y comencemos a plantar!!</h2>
    </div>
    <div class="chat-container">
      <div class="input-group">
        <label for="pregunta" class="sr-only">Tu pregunta</label>
        <textarea 
          id="pregunta" 
          placeholder="Escribe tu pregunta aqu칤..." 
          aria-label="Tu pregunta para Rebol-IA"
        ></textarea>
      </div>
      <div class="controls-group">
        <button 
          id="enviar" 
          class="send-button" 
          aria-label="Enviar pregunta"
        >
          <img src="/send.svg" alt="Enviar" id="send-icon" />
          <span class="loading" id="loading" style="display: none;"></span>
        </button>
      </div>
      <div class="response-group">
        <label for="respuesta">Respuesta de Rebol-IA:</label>
        <textarea 
          id="respuesta" 
          readonly 
          placeholder="La respuesta aparecer치 aqu칤..."
          aria-live="polite"
        ></textarea>
      </div>
    </div>
  </section> -->

  <h4 class="explore-title">Comienza a explorar</h4>

  <section id="ejemplos" class="ejemplos-grid">
    <!-- Ejemplo de Post de Planta -->
    <div class="plant-card">
      <div class="card-header">
        <div class="plant-info">
          <span class="plant-name">Bonsai Ficus</span>
          <span class="plant-origin">Origen: Asia Oriental</span>
        </div>
        <span class="plant-user">Usuario: Takyiu42</span>
      </div>
      <img src="/bonsai.jpg" alt="Bonsai Ficus" class="card-image">
      <div class="card-body">
        <div class="card-actions">
          <span>仇벒잺</span>
          <span>游눫</span>
          <span>游댕</span>
        </div>
        <div class="ai-analysis">
          <h4>An치lisis de Rebol IA</h4>
          <p><strong>Estado de Salud:</strong> <span class="status-healthy">Excelente</span></p>
          <p><strong>Edad Estimada:</strong> 5 a침os</p>
          <p><strong>Recomendaci칩n:</strong> El follaje es vigoroso y no se detectan plagas. El riego y la exposici칩n a la luz son adecuados. Continuar con el cuidado actual.</p>
        </div>
      </div>
    </div>
    <!-- Puedes copiar y pegar el div .plant-card para a침adir m치s ejemplos -->
  </section>

  <style>
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100vw;
    height: 100vh;
    overflow: auto;
    background-color: rgba(0,0,0,0.4);
  }
  .modal-content {
    background-color: #fff;
    margin: 10% auto;
    padding: 20px;
    border-radius: 10px;
    width: 90%;
    max-width: 400px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.2);
    position: relative;
  }
  .close {
    color: #aaa;
    position: absolute;
    top: 10px;
    right: 20px;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
  }
  .close:hover {
    color: #333;
  }
  .modal-content form {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .modal-content input[type="text"],
  .modal-content input[type="password"] {
    padding: 8px;
    border-radius: 5px;
    border: 1px solid #ccc;
    font-size: 1em;
  }
  .modal-content button[type="submit"] {
    background: #1B1C1D;
    color: #fff;
    border: none;
    border-radius: 5px;
    padding: 10px;
    font-size: 1em;
    cursor: pointer;
    margin-top: 10px;
  }
  .modal-content button[type="submit"]:hover {
    background: #333;
  }
  .ejemplos-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    padding: 20px;
  }

  .plant-card {
    background-color: #fff;
    border: 1px solid #dbdbdb;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  }

  .card-header {
    padding: 10px 15px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .plant-name {
    font-weight: 600;
    display: block;
  }

  .plant-origin {
    font-size: 0.8em;
    color: #8e8e8e;
  }
  .plant-user{
    font-size: 0.8em;
    color: #8e8e8e;
  }

  .card-image {
    width: 100%;
    height: auto;
    display: block;
  }

  .card-body {
    padding: 10px 15px;
  }

  .card-actions {
    font-size: 24px;
    display: flex;
    gap: 15px;
    margin-bottom: 10px;
  }

  .card-actions span {
    cursor: pointer;
    transition: transform 0.2s;
  }
  .card-actions span:hover {
    transform: scale(1.1);
  }

  .ai-analysis h4 {
    margin: 10px 0 5px 0;
    border-bottom: 1px solid #efefef;
    padding-bottom: 5px;
  }

  .ai-analysis p {
    font-size: 0.9em;
    line-height: 1.4;
    margin: 5px 0;
  }

  .status-healthy {
    color: #2e7d32;
    font-weight: bold;
  }

  /* Estilos para la secci칩n de introducci칩n */
  .section1 {
    display: flex;
    align-items: center;
    padding: 40px 20px;
    gap: 30px;
    max-width: 1000px;
    margin: 0 auto; /* Centrar la secci칩n */
  }
  .section1_img {
    flex: 1;
  }
  .section1_img img {
    width: 100%;
    border-radius: 12px;
  }
  .section_text {
    flex: 1.5;
  }

  /* T칤tulo de la secci칩n de exploraci칩n */
  .explore-title {
    text-align: center;
    font-size: 2.2rem;
    font-weight: 600;
    color: #2c3e50;
    margin-top: 40px;
    margin-bottom: 30px;
  }
  </style>

  <script>
    const preguntaTextarea = document.getElementById('pregunta');
    const respuestaTextarea = document.getElementById('respuesta');
    const enviarButton = document.getElementById('enviar');
    const sendIcon = document.getElementById('send-icon');
    const loadingSpinner = document.getElementById('loading');

    async function enviarPregunta() {
      const pregunta = (preguntaTextarea as HTMLTextAreaElement).value;
      if (!pregunta.trim()) return;
      
      (enviarButton as HTMLButtonElement).disabled = true;
      if (sendIcon) sendIcon.style.display = 'none';
      if (loadingSpinner) loadingSpinner.style.display = 'inline-block';
      (respuestaTextarea as HTMLTextAreaElement).value = 'Procesando...';

      try {
        const response = await fetch('/api/ia', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'x-api-key': '35434285d213edcbe5f57b38fc12fe2d481603aeeb372f098e779b74ea3ec646'
          },
          body: JSON.stringify({ pregunta })
        });
        
        if (!response.ok) {
            const errorData = await response.json().catch(() => ({ error: 'Error desconocido en la API' }));
            throw new Error(errorData.error || `Error: ${response.statusText}`);
        }

        const data = await response.json();
        (respuestaTextarea as HTMLTextAreaElement).value = data.respuesta;
      } catch (error) {
        (respuestaTextarea as HTMLTextAreaElement).value = `Error al conectar con la IA: ${error.message}`;
        console.error(error);
      } finally {
        (enviarButton as HTMLButtonElement).disabled = false;
        if (sendIcon) sendIcon.style.display = 'inline-block';
        if (loadingSpinner) loadingSpinner.style.display = 'none';
      }
    }

    if (enviarButton) {
      enviarButton.addEventListener('click', enviarPregunta);
    }

    if (preguntaTextarea) {
      preguntaTextarea.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          enviarPregunta();
        }
      });
    }

    const showButton = document.getElementById('show-examples');
    const ejemplosSection = document.getElementById('ejemplos');

    if (showButton && ejemplosSection) {
      showButton.addEventListener('click', () => {
        const isHidden = ejemplosSection.style.display === 'none';
        ejemplosSection.style.display = isHidden ? 'block' : 'none';
      });
    }

    // Modal Acceder
    const abrirModal = document.getElementById('abrir-modal');
    const cerrarModal = document.getElementById('cerrar-modal');
    const modalAcceso = document.getElementById('modal-acceso');

    if (abrirModal && modalAcceso) {
      abrirModal.addEventListener('click', () => {
        modalAcceso.style.display = 'block';
      });
    }
    if (cerrarModal && modalAcceso) {
      cerrarModal.addEventListener('click', () => {
        modalAcceso.style.display = 'none';
      });
    }
    // Cerrar modal al hacer click fuera del contenido
    window.addEventListener('click', (event) => {
      if (event.target === modalAcceso) {
        modalAcceso.style.display = 'none';
      }
    });

    // Login modal: l칩gica de formulario
    const formLogin = document.getElementById('form-login');
    const loginMsg = document.getElementById('login-msg');
    if (formLogin) {
      formLogin.addEventListener('submit', (e) => {
        e.preventDefault();
        const usuario = (document.getElementById('login-usuario') as HTMLInputElement).value;
        const password = (document.getElementById('login-password') as HTMLInputElement).value;
        // Aqu칤 puedes poner tu l칩gica real de autenticaci칩n
        if (usuario && password) {
          usuario === 'admin' && password === '1234' ?
          loginMsg.style.color = '#090' :
          loginMsg.textContent = '춰Login exitoso! (simulado)';  
          window.location.href = '/sub_pages/dasboard';
      

          // loginMsg.style.color = '#090';
          // loginMsg.textContent = '춰Login simulado exitoso! (aqu칤 va tu l칩gica real)';
          // Cerrar el modal despu칠s de 1 segundo
          setTimeout(() => {
            if (modalAcceso) modalAcceso.style.display = 'none';
            loginMsg.textContent = '';
            (formLogin as HTMLFormElement).reset();
          }, 1000);
        } else {
          loginMsg.style.color = '#c00';
          loginMsg.textContent = 'Por favor, completa ambos campos.';
        }
      });
    }
  </script>
</Layout>